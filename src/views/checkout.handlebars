<div class="checkout-container">
    <!-- Header del Checkout -->
    <div class="checkout-header">
        <h1 class="checkout-title">üí≥ Finalizar Compra</h1>
        <div class="checkout-steps">
            <div class="step active">
                <span class="step-number">1</span>
                <span class="step-text">Datos de Env√≠o</span>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <span class="step-text">Pago</span>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <span class="step-text">Confirmaci√≥n</span>
            </div>
        </div>
    </div>

    {{#if cart}}
        {{#if cart.products}}
            <div class="checkout-content">
                <!-- Columna izquierda: Formularios -->
                <div class="checkout-forms">
                    <form id="checkout-form">
                        <!-- Secci√≥n 1: Datos de Env√≠o -->
                        <div class="form-section active" id="shipping-section">
                            <div class="section-header">
                                <h2>üì¶ Datos de Env√≠o</h2>
                                <p>Ingresa la informaci√≥n para la entrega de tu pedido</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fullName">Nombre Completo *</label>
                                    <input type="text" id="fullName" name="fullName" required 
                                           placeholder="Ej: Mar√≠a Gonz√°lez" value="{{user.first_name}}">
                                    <span class="form-error" id="fullName-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="phone">Tel√©fono *</label>
                                    <input type="tel" id="phone" name="phone" required 
                                           placeholder="Ej: +54 11 1234-5678">
                                    <span class="form-error" id="phone-error"></span>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="address">Direcci√≥n Completa *</label>
                                    <input type="text" id="address" name="address" required 
                                           placeholder="Ej: Av. Corrientes 1234, Piso 5, Depto B">
                                    <span class="form-error" id="address-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="city">Ciudad *</label>
                                    <input type="text" id="city" name="city" required 
                                           placeholder="Ej: Buenos Aires">
                                    <span class="form-error" id="city-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="postalCode">C√≥digo Postal *</label>
                                    <input type="text" id="postalCode" name="postalCode" required 
                                           placeholder="Ej: C1043AAR">
                                    <span class="form-error" id="postalCode-error"></span>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-next" onclick="nextStep()">
                                    Continuar al Pago ‚Üí
                                </button>
                            </div>
                        </div>

                        <!-- Secci√≥n 2: M√©todo de Pago -->
                        <div class="form-section" id="payment-section">
                            <div class="section-header">
                                <h2>üí≥ M√©todo de Pago</h2>
                                <p>Selecciona tu m√©todo de pago preferido (Simulaci√≥n acad√©mica)</p>
                            </div>
                            
                            <!-- Selector de m√©todo de pago -->
                            <div class="payment-methods">
                                <div class="payment-method active" data-method="credit_card">
                                    <div class="payment-icon">üí≥</div>
                                    <div class="payment-info">
                                        <h3>Tarjeta de Cr√©dito</h3>
                                        <p>Visa, MasterCard, American Express</p>
                                    </div>
                                    <div class="payment-radio">
                                        <input type="radio" name="paymentMethod" value="credit_card" checked>
                                    </div>
                                </div>
                                
                                <div class="payment-method" data-method="debit_card">
                                    <div class="payment-icon">üí≥</div>
                                    <div class="payment-info">
                                        <h3>Tarjeta de D√©bito</h3>
                                        <p>D√©bito inmediato desde tu cuenta</p>
                                    </div>
                                    <div class="payment-radio">
                                        <input type="radio" name="paymentMethod" value="debit_card">
                                    </div>
                                </div>
                                
                                <div class="payment-method" data-method="bank_transfer">
                                    <div class="payment-icon">üè¶</div>
                                    <div class="payment-info">
                                        <h3>Transferencia Bancaria</h3>
                                        <p>Transferencia desde tu banco</p>
                                    </div>
                                    <div class="payment-radio">
                                        <input type="radio" name="paymentMethod" value="bank_transfer">
                                    </div>
                                </div>
                                
                                <div class="payment-method" data-method="cash_on_delivery">
                                    <div class="payment-icon">üíµ</div>
                                    <div class="payment-info">
                                        <h3>Pago Contra Entrega</h3>
                                        <p>Paga cuando recibas tu pedido</p>
                                    </div>
                                    <div class="payment-radio">
                                        <input type="radio" name="paymentMethod" value="cash_on_delivery">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Formulario de tarjeta (solo visible para tarjetas) -->
                            <div class="card-form" id="card-form">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="cardNumber">N√∫mero de Tarjeta *</label>
                                        <input type="text" id="cardNumber" name="cardNumber" 
                                               placeholder="1234 5678 9012 3456" maxlength="19"
                                               value="4111 1111 1111 1111">
                                        <span class="form-error" id="cardNumber-error"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="expiryDate">Fecha de Vencimiento *</label>
                                        <input type="text" id="expiryDate" name="expiryDate" 
                                               placeholder="MM/AA" maxlength="5" value="12/28">
                                        <span class="form-error" id="expiryDate-error"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cvv">CVV *</label>
                                        <input type="text" id="cvv" name="cvv" 
                                               placeholder="123" maxlength="4" value="123">
                                        <span class="form-error" id="cvv-error"></span>
                                    </div>
                                    
                                    <div class="form-group full-width">
                                        <label for="cardName">Nombre en la Tarjeta *</label>
                                        <input type="text" id="cardName" name="cardName" 
                                               placeholder="Nombre como aparece en la tarjeta"
                                               value="{{user.first_name}}">
                                        <span class="form-error" id="cardName-error"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="academic-notice">
                                <div class="notice-icon">‚ÑπÔ∏è</div>
                                <div class="notice-text">
                                    <strong>Nota Acad√©mica:</strong> Esta es una simulaci√≥n. No se realizar√°n cargos reales. 
                                    Los datos de tarjeta son de prueba y no se almacenan.
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                    ‚Üê Volver a Datos
                                </button>
                                <button type="button" class="btn btn-next" onclick="nextStep()">
                                    Revisar Pedido ‚Üí
                                </button>
                            </div>
                        </div>

                        <!-- Secci√≥n 3: Confirmaci√≥n -->
                        <div class="form-section" id="confirmation-section">
                            <div class="section-header">
                                <h2>‚úÖ Confirmaci√≥n del Pedido</h2>
                                <p>Revisa todos los datos antes de confirmar tu compra</p>
                            </div>
                            
                            <!-- Resumen de datos -->
                            <div class="confirmation-summary">
                                <div class="summary-section">
                                    <h3>üì¶ Datos de Env√≠o</h3>
                                    <div id="shipping-summary" class="summary-content"></div>
                                </div>
                                
                                <div class="summary-section">
                                    <h3>üí≥ M√©todo de Pago</h3>
                                    <div id="payment-summary" class="summary-content"></div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                    ‚Üê Volver a Pago
                                </button>
                                <button type="submit" class="btn btn-primary btn-confirm" id="confirm-order">
                                    <span class="btn-text">üõí Confirmar Pedido</span>
                                    <div class="btn-loader" style="display: none;">
                                        <div class="spinner"></div>
                                        Procesando...
                                    </div>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Columna derecha: Resumen del pedido -->
                <div class="order-summary">
                    <div class="summary-card">
                        <h3>üìã Resumen del Pedido</h3>
                        
                        <div class="summary-products">
                            {{#each cart.products}}
                            <div class="summary-product">
                                <div class="product-info">
                                    <h4>{{product.nombre}}</h4>
                                    <p>Cantidad: {{quantity}}</p>
                                </div>
                                <div class="product-price">
                                    ${{multiply product.precio quantity}}
                                </div>
                            </div>
                            {{/each}}
                        </div>
                        
                        <div class="summary-totals">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span>${{cart.totalAmount}}</span>
                            </div>
                            <div class="total-row">
                                <span>Env√≠o:</span>
                                <span class="free-shipping">GRATIS</span>
                            </div>
                            <div class="total-row total-final">
                                <span>Total:</span>
                                <span>${{cart.totalAmount}}</span>
                            </div>
                        </div>
                        
                        <div class="summary-benefits">
                            <div class="benefit">
                                <span class="benefit-icon">üöö</span>
                                <span>Env√≠o gratis</span>
                            </div>
                            <div class="benefit">
                                <span class="benefit-icon">üîí</span>
                                <span>Compra segura</span>
                            </div>
                            <div class="benefit">
                                <span class="benefit-icon">‚Ü©Ô∏è</span>
                                <span>Devoluci√≥n f√°cil</span>
                            </div>
                        </div>
                        
                        <div class="summary-actions">
                            <a href="/carrito" class="btn btn-outline">
                                ‚Üê Editar Carrito
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {{else}}
            <div class="empty-checkout">
                <div class="empty-icon">üõí</div>
                <h2>Tu carrito est√° vac√≠o</h2>
                <p>Agrega algunos productos antes de proceder al checkout.</p>
                <a href="/productos" class="btn btn-primary">
                    üõçÔ∏è Explorar Productos
                </a>
            </div>
        {{/if}}
    {{else}}
        <div class="empty-checkout">
            <div class="empty-icon">üõí</div>
            <h2>Tu carrito est√° vac√≠o</h2>
            <p>Agrega algunos productos antes de proceder al checkout.</p>
            <a href="/productos" class="btn btn-primary">
                üõçÔ∏è Explorar Productos
            </a>
        </div>
    {{/if}}
</div>

<!-- Modal de procesamiento -->
<div id="processing-modal" class="modal">
    <div class="modal-content processing-modal">
        <div class="processing-header">
            <h3>üí≥ Procesando tu pago...</h3>
        </div>
        <div class="processing-body">
            <div class="processing-animation">
                <div class="card-animation">üí≥</div>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
            <p id="processing-message">Validando informaci√≥n de pago...</p>
        </div>
    </div>
</div>

<!-- Modal de √©xito -->
<div id="success-modal" class="modal">
    <div class="modal-content success-modal">
        <div class="success-header">
            <div class="success-icon">‚úÖ</div>
            <h3>¬°Pedido Confirmado!</h3>
        </div>
        <div class="success-body">
            <p>Tu pedido ha sido procesado exitosamente.</p>
            <div class="order-details">
                <p><strong>N√∫mero de orden:</strong> <span id="order-number"></span></p>
                <p><strong>Total pagado:</strong> $<span id="order-total"></span></p>
                <p><strong>Entrega estimada:</strong> <span id="delivery-date"></span></p>
            </div>
            <p>Recibir√°s un email de confirmaci√≥n con los detalles de tu pedido.</p>
        </div>
        <div class="success-footer">
            <a href="/productos" class="btn btn-secondary">Seguir Comprando</a>
            <a href="/profile" class="btn btn-primary">Ver Mis Pedidos</a>
        </div>
    </div>
</div>